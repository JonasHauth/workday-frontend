{% extends 'layout.html' %}



{% block css %}

<!-- Paddle Payment-->
<script src="https://cdn.paddle.com/paddle/paddle.js"></script>
<script type="text/javascript">
	Paddle.Setup({ vendor: 743086 });
</script>
{% endblock %}

{% block content %}

<div class="container">
  <div class="row"><p>Hey Jonas, deine Empfehlungen f√ºr heute...</p></div>

  <div class="row">

    {% for space in spaces[0:3] %}


    <div class="col">
      <div class="card" style="width: 18rem;">
        <img src="static/{{ space.img }}" alt={{ space.name }}  class="card-img-top"/>
        <div class="card-body">
          <h5 class="card-title">{{ space.name }}</h5>
          <p class="card-text" style=" white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 400ch;">{{ space.description }}</p>
          <p>{{ space.price }} </p>
          <p>{{ space.street }}<br>{{ space.city }}</p>
          <div role="button" id="payonetime" data-toggle="modal" data-target="#bezahlen" 
               data-name="{{ space.name }}" data-beschreibung="{{ space.description }}" >
               Bezahlen
          </div>
          
        </div>
      </div>
    </div>

    {% endfor %}

    
  </div>

  

</div>

    <div id='calendar' class="container" style="margin-bottom: 100px !important"></div>

    <script>

      document.addEventListener("DOMContentLoaded", function () {
      var calendarEl = document.getElementById("calendar");
      var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "listWeek",
      locale: 'de',
      contentHeight: 'auto',

      headerToolbar: 
      {
        left: "prev,next today",
        center: "title",
        right: "dayGridMonth,timeGridWeek,timeGridDay, listWeek",
      },

      selectable: true,
      selectHelper: true,
      select: function(start, end, allDay)
      {
        var title = prompt ("Enter Event Titel");
        if (title)
        {
          
          var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
          var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
          $.ajax
          (
            {
              url:"/calendar/insert",
              type:"POST",
              data:{title:title, start:start, end:end},
              success:function(data)
               {
                 //alert(data)
                  alert("Added Successfully");
                  window.location.replace("/");
                }
            }
          )

        }
      },

      editable: true,

      eventResize:function(event)
      {
        var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
        var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
        var title = event.title;
        var id = event.id;
        $.ajax
        (
          {
            url:"/calendar/update",
            type:"POST",
            data:{title:title, start:start, end:end, id:id},
            success:function()
            {
              calendar.fullCalendar('refetchEvents');
              alert('Event Update');
            }
          }
        )
      },
      
      eventDrop:function(event)
      {
        var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
        var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
        var title = event.title;
        var id = event.id;
        $.ajax
        (
          {
            url:"/calendar/update",
            type:"POST",
            data:{title:title, start:start, end:end, id:id},
            success:function()
            {
              calendar.fullCalendar('refetchEvents');
              alert("Event Updated");
            }
          }
        );
      },
  
      eventClick:function(event)
      {
        if(confirm("Are you sure you want to remove it?"))
        {
          var id = event.id;
          $.ajax
          (
            {
              url:"/calendar/delete",
              type:"POST",
              data:{id:id},
              success:function()
              {
                calendar.fullCalendar('refetchEvents');
                alert("Event Removed");
              }
            }
          )
        }
      },
  

      events : 
      [
        {% for event in events %}
        {
          title : '{{event.title}}',
          start : '{{event.start}}',
        },
        {% endfor %}
      ],
    
    });
    
    calendar.render();
    });

    </script>  










<!-- CHECKOUT MODAL 1  / HTML -->   

<div class="modal fade" id="bezahlen" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 10000000000;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLabel">CHECKOUT </h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color: #aaa !important;">x</span></button>
      </div>

      <div class="modal-body">
        <form id="pre-checkout" style="margin-top: 40px;">
          <input id="name" type="text" value="" placeholder="Name" style="width:100%; margin-bottom: 8px;">
          <input id="useremail" type="text" value="" placeholder="E-Mail-Adresse" style="width:100%">   
        </form>
       <div class="checkout-container"></div>
      </div>

      <div class="modal-footer">
      </div>

    </div>
  </div>
  </div>
<!-- CHECKOUT MODAL / ENDE-->    

<!-- CHECKOUT MODAL 1 /JAVASCRIPT -->   
<script>

  //Paddle Payment ------------
  
    Paddle.Setup
    (
      {
        vendor: 743086,         
      }
    );
    
  
  
  //Paddle -- Pre-Checkout
  var form = document.getElementById('pre-checkout');
  
  
  //Paddle --- Open Paddle Checkout  
      Paddle.Checkout.open({
        method: 'inline',
        product: 780653,  
        email: 'lara.kresiz@gmx.de', // form.useremail.value
        country: 'DE',
        postcode: '76185',
        allowQuantity: false,
        disableLogout: true,
        success: 'https://127.0.0.1:5000/calendar', 
        frameTarget: 'checkout-container',
        frameInitialHeight: 416,
        frameStyle: 'width:100%; min-width:312px; background-color: transparent; border: none;'    
      });
  
</script>
  
{% endblock %} 