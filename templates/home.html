{% extends 'layout.html' %}



{% block css %}
{% endblock %}

{% block content %}

<div class="container">
        <h1>{{title}}</h1>
        <p>{{description}}</p>
        <p>This is an example of a <span class="material-icons">face</span> face icon.</p>
    </div>

    <div id='calendar'></div>

    <script>

      document.addEventListener("DOMContentLoaded", function () {
      var calendarEl = document.getElementById("calendar");
      var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "listWeek",

      headerToolbar: 
      {
        left: "prev,next today",
        center: "title",
        right: "dayGridMonth,timeGridWeek,timeGridDay",
      },

      selectable: true,
      selectHelper: true,
      select: function(start, end, allDay)
      {
        var title = prompt ("Enter Event Titel");
        if (title)
        {
          
          var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
          var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
          $.ajax
          (
            {
              url:"/calendar/insert",
              type:"POST",
              data:{title:title, start:start, end:end},
              success:function(data)
               {
                 //alert(data)
                  alert("Added Successfully");
                  window.location.replace("/");
                }
            }
          )

        }
      },

      editable: true,

      eventResize:function(event)
      {
        var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
        var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
        var title = event.title;
        var id = event.id;
        $.ajax
        (
          {
            url:"/calendar/update",
            type:"POST",
            data:{title:title, start:start, end:end, id:id},
            success:function()
            {
              calendar.fullCalendar('refetchEvents');
              alert('Event Update');
            }
          }
        )
      },
      
      eventDrop:function(event)
      {
        var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
        var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
        var title = event.title;
        var id = event.id;
        $.ajax
        (
          {
            url:"/calendar/update",
            type:"POST",
            data:{title:title, start:start, end:end, id:id},
            success:function()
            {
              calendar.fullCalendar('refetchEvents');
              alert("Event Updated");
            }
          }
        );
      },
  
      eventClick:function(event)
      {
        if(confirm("Are you sure you want to remove it?"))
        {
          var id = event.id;
          $.ajax
          (
            {
              url:"/calendar/delete",
              type:"POST",
              data:{id:id},
              success:function()
              {
                calendar.fullCalendar('refetchEvents');
                alert("Event Removed");
              }
            }
          )
        }
      },
  

      events : 
      [
        {% for event in events %}
        {
          title : '{{event.title}}',
          start : '{{event.start}}',
        },
        {% endfor %}
      ],
    
    });
    
    calendar.render();
    });

    </script>  
  
{% endblock %} 